name: flybase-db-update
on:
  workflow_dispatch:
env:
  FB_EMAIL: iudev@morgan.harvard.edu
  FB_RELEASE: FB2022_04
  DMEL_RELEASE: 6.47
jobs:
  update-flybase:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Install poetry
        run: pipx install poetry
      - uses: actions/setup-python@v4
        with:
          python-version: '3.10'
          cache: 'poetry'
      - run: poetry install
      - name: Update FlyBase metadata file
        run: |
          rm ./conf/flybase/databases.json && \
          make conf/flybase/databases.json
        env:
          FB_EMAIL: ${{ env.FB_EMAIL }}
          FB_RELEASE: ${{ env.FB_RELEASE }}
          DMEL_RELEASE: ${{ env.DMEL_RELEASE }}
      - name: Create PR for DB metadata update
        uses: peter-evans/create-pull-request@v4
        with:
          title: Update FlyBase DB metadata for ${{ env.FB_RELEASE }}
          body: Auto-generated PR for FlyBase DB metadata updates.
          add-paths: conf/flybase/databases.json
          branch: flybase-db-update


